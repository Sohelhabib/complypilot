{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":102,"index":102}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":103},"end":{"line":2,"column":69,"index":172}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":173},"end":{"line":3,"column":42,"index":215}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.AuthProvider = AuthProvider;\n  exports.useAuth = useAuth;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function AuthProvider({\n    children\n  }) {\n    const [user, setUser] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    const checkAuth = (0, _react.useCallback)(async () => {\n      // CRITICAL: If returning from OAuth callback, skip the /me check.\n      // AuthCallback will exchange the session_id and establish the session first.\n      if (false && window.location?.hash?.includes('session_id=')) {\n        setLoading(false);\n        return;\n      }\n      try {\n        const token = await AsyncStorage.default.getItem('session_token');\n        if (token) {\n          const userData = await _servicesApi.authAPI.getMe();\n          setUser(userData);\n        }\n      } catch (error) {\n        console.log('Auth check failed:', error);\n        await AsyncStorage.default.removeItem('session_token');\n        setUser(null);\n      } finally {\n        setLoading(false);\n      }\n    }, []);\n    (0, _react.useEffect)(() => {\n      checkAuth();\n    }, [checkAuth]);\n    const login = async sessionId => {\n      setLoading(true);\n      try {\n        const result = await _servicesApi.authAPI.exchangeSession(sessionId);\n        if (result.user) {\n          setUser(result.user);\n          // For mobile, also try to extract session token from cookies if not already stored\n        }\n      } catch (error) {\n        console.error('Login failed:', error);\n        throw error;\n      } finally {\n        setLoading(false);\n      }\n    };\n    const logout = async () => {\n      setLoading(true);\n      try {\n        await _servicesApi.authAPI.logout();\n      } catch (error) {\n        console.error('Logout error:', error);\n      } finally {\n        setUser(null);\n        await AsyncStorage.default.removeItem('session_token');\n        setLoading(false);\n      }\n    };\n    const refreshUser = async () => {\n      try {\n        const userData = await _servicesApi.authAPI.getMe();\n        setUser(userData);\n      } catch (error) {\n        console.error('Refresh user failed:', error);\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        user,\n        loading,\n        isAuthenticated: !!user,\n        login,\n        logout,\n        refreshUser,\n        setUser\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }, this);\n  }\n  function useAuth() {\n    const context = (0, _react.useContext)(AuthContext);\n    if (context === undefined) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  }\n});","lineCount":109,"map":[[13,2,28,0,"exports"],[13,9,28,0],[13,10,28,0,"AuthProvider"],[13,22,28,0],[13,25,28,0,"AuthProvider"],[13,37,28,0],[14,2,114,0,"exports"],[14,9,114,0],[14,10,114,0,"useAuth"],[14,17,114,0],[14,20,114,0,"useAuth"],[14,27,114,0],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,2,0],[16,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,2,0],[16,45,2,0,"require"],[16,52,2,0],[16,53,2,0,"_dependencyMap"],[16,67,2,0],[17,2,2,0],[17,6,2,0,"AsyncStorage"],[17,18,2,0],[17,21,2,0,"_interopDefault"],[17,36,2,0],[17,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,2,0],[18,2,3,0],[18,6,3,0,"_servicesApi"],[18,18,3,0],[18,21,3,0,"require"],[18,28,3,0],[18,29,3,0,"_dependencyMap"],[18,43,3,0],[19,2,3,42],[19,6,3,42,"_reactJsxDevRuntime"],[19,25,3,42],[19,28,3,42,"require"],[19,35,3,42],[19,36,3,42,"_dependencyMap"],[19,50,3,42],[20,2,26,0],[20,8,26,6,"AuthContext"],[20,19,26,17],[20,35,26,20],[20,39,26,20,"createContext"],[20,45,26,33],[20,46,26,33,"createContext"],[20,59,26,33],[20,61,26,63,"undefined"],[20,70,26,72],[20,71,26,73],[21,2,28,7],[21,11,28,16,"AuthProvider"],[21,23,28,28,"AuthProvider"],[21,24,28,29],[22,4,28,31,"children"],[23,2,28,65],[23,3,28,66],[23,5,28,68],[24,4,29,2],[24,10,29,8],[24,11,29,9,"user"],[24,15,29,13],[24,17,29,15,"setUser"],[24,24,29,22],[24,25,29,23],[24,28,29,26],[24,32,29,26,"useState"],[24,38,29,34],[24,39,29,34,"useState"],[24,47,29,34],[24,49,29,48],[24,53,29,52],[24,54,29,53],[25,4,30,2],[25,10,30,8],[25,11,30,9,"loading"],[25,18,30,16],[25,20,30,18,"setLoading"],[25,30,30,28],[25,31,30,29],[25,34,30,32],[25,38,30,32,"useState"],[25,44,30,40],[25,45,30,40,"useState"],[25,53,30,40],[25,55,30,41],[25,59,30,45],[25,60,30,46],[26,4,32,2],[26,10,32,8,"checkAuth"],[26,19,32,17],[26,22,32,20],[26,26,32,20,"useCallback"],[26,32,32,31],[26,33,32,31,"useCallback"],[26,44,32,31],[26,46,32,32],[26,58,32,44],[27,6,33,4],[28,6,34,4],[29,6,35,4],[29,10,35,8],[29,19,35,41,"window"],[29,25,35,47],[29,26,35,48,"location"],[29,34,35,56],[29,36,35,58,"hash"],[29,40,35,62],[29,42,35,64,"includes"],[29,50,35,72],[29,51,35,73],[29,64,35,86],[29,65,35,87],[29,67,35,89],[30,8,36,6,"setLoading"],[30,18,36,16],[30,19,36,17],[30,24,36,22],[30,25,36,23],[31,8,37,6],[32,6,38,4],[33,6,40,4],[33,10,40,8],[34,8,41,6],[34,14,41,12,"token"],[34,19,41,17],[34,22,41,20],[34,28,41,26,"AsyncStorage"],[34,40,41,38],[34,41,41,38,"default"],[34,48,41,38],[34,49,41,39,"getItem"],[34,56,41,46],[34,57,41,47],[34,72,41,62],[34,73,41,63],[35,8,42,6],[35,12,42,10,"token"],[35,17,42,15],[35,19,42,17],[36,10,43,8],[36,16,43,14,"userData"],[36,24,43,22],[36,27,43,25],[36,33,43,31,"authAPI"],[36,45,43,38],[36,46,43,38,"authAPI"],[36,53,43,38],[36,54,43,39,"getMe"],[36,59,43,44],[36,60,43,45],[36,61,43,46],[37,10,44,8,"setUser"],[37,17,44,15],[37,18,44,16,"userData"],[37,26,44,24],[37,27,44,25],[38,8,45,6],[39,6,46,4],[39,7,46,5],[39,8,46,6],[39,15,46,13,"error"],[39,20,46,18],[39,22,46,20],[40,8,47,6,"console"],[40,15,47,13],[40,16,47,14,"log"],[40,19,47,17],[40,20,47,18],[40,40,47,38],[40,42,47,40,"error"],[40,47,47,45],[40,48,47,46],[41,8,48,6],[41,14,48,12,"AsyncStorage"],[41,26,48,24],[41,27,48,24,"default"],[41,34,48,24],[41,35,48,25,"removeItem"],[41,45,48,35],[41,46,48,36],[41,61,48,51],[41,62,48,52],[42,8,49,6,"setUser"],[42,15,49,13],[42,16,49,14],[42,20,49,18],[42,21,49,19],[43,6,50,4],[43,7,50,5],[43,16,50,14],[44,8,51,6,"setLoading"],[44,18,51,16],[44,19,51,17],[44,24,51,22],[44,25,51,23],[45,6,52,4],[46,4,53,2],[46,5,53,3],[46,7,53,5],[46,9,53,7],[46,10,53,8],[47,4,55,2],[47,8,55,2,"useEffect"],[47,14,55,11],[47,15,55,11,"useEffect"],[47,24,55,11],[47,26,55,12],[47,32,55,18],[48,6,56,4,"checkAuth"],[48,15,56,13],[48,16,56,14],[48,17,56,15],[49,4,57,2],[49,5,57,3],[49,7,57,5],[49,8,57,6,"checkAuth"],[49,17,57,15],[49,18,57,16],[49,19,57,17],[50,4,59,2],[50,10,59,8,"login"],[50,15,59,13],[50,18,59,16],[50,24,59,23,"sessionId"],[50,33,59,40],[50,37,59,45],[51,6,60,4,"setLoading"],[51,16,60,14],[51,17,60,15],[51,21,60,19],[51,22,60,20],[52,6,61,4],[52,10,61,8],[53,8,62,6],[53,14,62,12,"result"],[53,20,62,18],[53,23,62,21],[53,29,62,27,"authAPI"],[53,41,62,34],[53,42,62,34,"authAPI"],[53,49,62,34],[53,50,62,35,"exchangeSession"],[53,65,62,50],[53,66,62,51,"sessionId"],[53,75,62,60],[53,76,62,61],[54,8,63,6],[54,12,63,10,"result"],[54,18,63,16],[54,19,63,17,"user"],[54,23,63,21],[54,25,63,23],[55,10,64,8,"setUser"],[55,17,64,15],[55,18,64,16,"result"],[55,24,64,22],[55,25,64,23,"user"],[55,29,64,27],[55,30,64,28],[56,10,65,8],[57,8,66,6],[58,6,67,4],[58,7,67,5],[58,8,67,6],[58,15,67,13,"error"],[58,20,67,18],[58,22,67,20],[59,8,68,6,"console"],[59,15,68,13],[59,16,68,14,"error"],[59,21,68,19],[59,22,68,20],[59,37,68,35],[59,39,68,37,"error"],[59,44,68,42],[59,45,68,43],[60,8,69,6],[60,14,69,12,"error"],[60,19,69,17],[61,6,70,4],[61,7,70,5],[61,16,70,14],[62,8,71,6,"setLoading"],[62,18,71,16],[62,19,71,17],[62,24,71,22],[62,25,71,23],[63,6,72,4],[64,4,73,2],[64,5,73,3],[65,4,75,2],[65,10,75,8,"logout"],[65,16,75,14],[65,19,75,17],[65,25,75,17,"logout"],[65,26,75,17],[65,31,75,29],[66,6,76,4,"setLoading"],[66,16,76,14],[66,17,76,15],[66,21,76,19],[66,22,76,20],[67,6,77,4],[67,10,77,8],[68,8,78,6],[68,14,78,12,"authAPI"],[68,26,78,19],[68,27,78,19,"authAPI"],[68,34,78,19],[68,35,78,20,"logout"],[68,41,78,26],[68,42,78,27],[68,43,78,28],[69,6,79,4],[69,7,79,5],[69,8,79,6],[69,15,79,13,"error"],[69,20,79,18],[69,22,79,20],[70,8,80,6,"console"],[70,15,80,13],[70,16,80,14,"error"],[70,21,80,19],[70,22,80,20],[70,37,80,35],[70,39,80,37,"error"],[70,44,80,42],[70,45,80,43],[71,6,81,4],[71,7,81,5],[71,16,81,14],[72,8,82,6,"setUser"],[72,15,82,13],[72,16,82,14],[72,20,82,18],[72,21,82,19],[73,8,83,6],[73,14,83,12,"AsyncStorage"],[73,26,83,24],[73,27,83,24,"default"],[73,34,83,24],[73,35,83,25,"removeItem"],[73,45,83,35],[73,46,83,36],[73,61,83,51],[73,62,83,52],[74,8,84,6,"setLoading"],[74,18,84,16],[74,19,84,17],[74,24,84,22],[74,25,84,23],[75,6,85,4],[76,4,86,2],[76,5,86,3],[77,4,88,2],[77,10,88,8,"refreshUser"],[77,21,88,19],[77,24,88,22],[77,30,88,22,"refreshUser"],[77,31,88,22],[77,36,88,34],[78,6,89,4],[78,10,89,8],[79,8,90,6],[79,14,90,12,"userData"],[79,22,90,20],[79,25,90,23],[79,31,90,29,"authAPI"],[79,43,90,36],[79,44,90,36,"authAPI"],[79,51,90,36],[79,52,90,37,"getMe"],[79,57,90,42],[79,58,90,43],[79,59,90,44],[80,8,91,6,"setUser"],[80,15,91,13],[80,16,91,14,"userData"],[80,24,91,22],[80,25,91,23],[81,6,92,4],[81,7,92,5],[81,8,92,6],[81,15,92,13,"error"],[81,20,92,18],[81,22,92,20],[82,8,93,6,"console"],[82,15,93,13],[82,16,93,14,"error"],[82,21,93,19],[82,22,93,20],[82,44,93,42],[82,46,93,44,"error"],[82,51,93,49],[82,52,93,50],[83,6,94,4],[84,4,95,2],[84,5,95,3],[85,4,97,2],[85,24,98,4],[85,28,98,4,"_reactJsxDevRuntime"],[85,47,98,4],[85,48,98,4,"jsxDEV"],[85,54,98,4],[85,56,98,5,"AuthContext"],[85,67,98,16],[85,68,98,17,"Provider"],[85,76,98,25],[86,6,99,6,"value"],[86,11,99,11],[86,13,99,13],[87,8,100,8,"user"],[87,12,100,12],[88,8,101,8,"loading"],[88,15,101,15],[89,8,102,8,"isAuthenticated"],[89,23,102,23],[89,25,102,25],[89,26,102,26],[89,27,102,27,"user"],[89,31,102,31],[90,8,103,8,"login"],[90,13,103,13],[91,8,104,8,"logout"],[91,14,104,14],[92,8,105,8,"refreshUser"],[92,19,105,19],[93,8,106,8,"setUser"],[94,6,107,6],[94,7,107,8],[95,6,107,8,"children"],[95,14,107,8],[95,16,109,7,"children"],[96,4,109,15],[97,6,109,15,"fileName"],[97,14,109,15],[97,16,109,15,"_jsxFileName"],[97,28,109,15],[98,6,109,15,"lineNumber"],[98,16,109,15],[99,6,109,15,"columnNumber"],[99,18,109,15],[100,4,109,15],[100,11,110,26],[100,12,110,27],[101,2,112,0],[102,2,114,7],[102,11,114,16,"useAuth"],[102,18,114,23,"useAuth"],[102,19,114,23],[102,21,114,26],[103,4,115,2],[103,10,115,8,"context"],[103,17,115,15],[103,20,115,18],[103,24,115,18,"useContext"],[103,30,115,28],[103,31,115,28,"useContext"],[103,41,115,28],[103,43,115,29,"AuthContext"],[103,54,115,40],[103,55,115,41],[104,4,116,2],[104,8,116,6,"context"],[104,15,116,13],[104,20,116,18,"undefined"],[104,29,116,27],[104,31,116,29],[105,6,117,4],[105,12,117,10],[105,16,117,14,"Error"],[105,21,117,19],[105,22,117,20],[105,67,117,65],[105,68,117,66],[106,4,118,2],[107,4,119,2],[107,11,119,9,"context"],[107,18,119,16],[108,2,120,0],[109,0,120,1],[109,3]],"functionMap":{"names":["<global>","AuthProvider","checkAuth","useEffect$argument_0","login","logout","refreshUser","useAuth"],"mappings":"AAA;OC2B;gCCI;GDqB;YEE;GFE;gBGE;GHc;iBIE;GJW;sBKE;GLO;CDiB;OOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}