{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":102,"index":102}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":103},"end":{"line":2,"column":69,"index":172}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":173},"end":{"line":3,"column":42,"index":215}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.AuthProvider = AuthProvider;\n  exports.useAuth = useAuth;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function AuthProvider({\n    children\n  }) {\n    _s();\n    const [user, setUser] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    const checkAuth = (0, _react.useCallback)(async () => {\n      // CRITICAL: If returning from OAuth callback, skip the /me check.\n      // AuthCallback will exchange the session_id and establish the session first.\n      if (typeof window !== 'undefined' && window.location?.hash?.includes('session_id=')) {\n        setLoading(false);\n        return;\n      }\n      try {\n        const token = await AsyncStorage.default.getItem('session_token');\n        if (token) {\n          const userData = await _servicesApi.authAPI.getMe();\n          setUser(userData);\n        }\n      } catch (error) {\n        console.log('Auth check failed:', error);\n        await AsyncStorage.default.removeItem('session_token');\n        setUser(null);\n      } finally {\n        setLoading(false);\n      }\n    }, []);\n    (0, _react.useEffect)(() => {\n      checkAuth();\n    }, [checkAuth]);\n    const login = async sessionId => {\n      setLoading(true);\n      try {\n        const result = await _servicesApi.authAPI.exchangeSession(sessionId);\n        if (result.user) {\n          setUser(result.user);\n          // For mobile, also try to extract session token from cookies if not already stored\n        }\n      } catch (error) {\n        console.error('Login failed:', error);\n        throw error;\n      } finally {\n        setLoading(false);\n      }\n    };\n    const logout = async () => {\n      setLoading(true);\n      try {\n        await _servicesApi.authAPI.logout();\n      } catch (error) {\n        console.error('Logout error:', error);\n      } finally {\n        setUser(null);\n        await AsyncStorage.default.removeItem('session_token');\n        setLoading(false);\n      }\n    };\n    const refreshUser = async () => {\n      try {\n        const userData = await _servicesApi.authAPI.getMe();\n        setUser(userData);\n      } catch (error) {\n        console.error('Refresh user failed:', error);\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        user,\n        loading,\n        isAuthenticated: !!user,\n        login,\n        logout,\n        refreshUser,\n        setUser\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }, this);\n  }\n  _s(AuthProvider, \"BttoceN+EwCpc7gKgbMYkdwK578=\");\n  _c = AuthProvider;\n  function useAuth() {\n    _s2();\n    const context = (0, _react.useContext)(AuthContext);\n    if (context === undefined) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  }\n  _s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  var _c;\n  $RefreshReg$(_c, \"AuthProvider\");\n});","lineCount":118,"map":[[15,2,28,0,"exports"],[15,9,28,0],[15,10,28,0,"AuthProvider"],[15,22,28,0],[15,25,28,0,"AuthProvider"],[15,37,28,0],[16,2,114,0,"exports"],[16,9,114,0],[16,10,114,0,"useAuth"],[16,17,114,0],[16,20,114,0,"useAuth"],[16,27,114,0],[17,2,1,0],[17,6,1,0,"_react"],[17,12,1,0],[17,15,1,0,"require"],[17,22,1,0],[17,23,1,0,"_dependencyMap"],[17,37,1,0],[18,2,2,0],[18,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[18,42,2,0],[18,45,2,0,"require"],[18,52,2,0],[18,53,2,0,"_dependencyMap"],[18,67,2,0],[19,2,2,0],[19,6,2,0,"AsyncStorage"],[19,18,2,0],[19,21,2,0,"_interopDefault"],[19,36,2,0],[19,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[19,73,2,0],[20,2,3,0],[20,6,3,0,"_servicesApi"],[20,18,3,0],[20,21,3,0,"require"],[20,28,3,0],[20,29,3,0,"_dependencyMap"],[20,43,3,0],[21,2,3,42],[21,6,3,42,"_reactJsxDevRuntime"],[21,25,3,42],[21,28,3,42,"require"],[21,35,3,42],[21,36,3,42,"_dependencyMap"],[21,50,3,42],[22,2,26,0],[22,8,26,6,"AuthContext"],[22,19,26,17],[22,35,26,20],[22,39,26,20,"createContext"],[22,45,26,33],[22,46,26,33,"createContext"],[22,59,26,33],[22,61,26,63,"undefined"],[22,70,26,72],[22,71,26,73],[23,2,28,7],[23,11,28,16,"AuthProvider"],[23,23,28,28,"AuthProvider"],[23,24,28,29],[24,4,28,31,"children"],[25,2,28,65],[25,3,28,66],[25,5,28,68],[26,4,28,68,"_s"],[26,6,28,68],[27,4,29,2],[27,10,29,8],[27,11,29,9,"user"],[27,15,29,13],[27,17,29,15,"setUser"],[27,24,29,22],[27,25,29,23],[27,28,29,26],[27,32,29,26,"useState"],[27,38,29,34],[27,39,29,34,"useState"],[27,47,29,34],[27,49,29,48],[27,53,29,52],[27,54,29,53],[28,4,30,2],[28,10,30,8],[28,11,30,9,"loading"],[28,18,30,16],[28,20,30,18,"setLoading"],[28,30,30,28],[28,31,30,29],[28,34,30,32],[28,38,30,32,"useState"],[28,44,30,40],[28,45,30,40,"useState"],[28,53,30,40],[28,55,30,41],[28,59,30,45],[28,60,30,46],[29,4,32,2],[29,10,32,8,"checkAuth"],[29,19,32,17],[29,22,32,20],[29,26,32,20,"useCallback"],[29,32,32,31],[29,33,32,31,"useCallback"],[29,44,32,31],[29,46,32,32],[29,58,32,44],[30,6,33,4],[31,6,34,4],[32,6,35,4],[32,10,35,8],[32,17,35,15,"window"],[32,23,35,21],[32,28,35,26],[32,39,35,37],[32,43,35,41,"window"],[32,49,35,47],[32,50,35,48,"location"],[32,58,35,56],[32,60,35,58,"hash"],[32,64,35,62],[32,66,35,64,"includes"],[32,74,35,72],[32,75,35,73],[32,88,35,86],[32,89,35,87],[32,91,35,89],[33,8,36,6,"setLoading"],[33,18,36,16],[33,19,36,17],[33,24,36,22],[33,25,36,23],[34,8,37,6],[35,6,38,4],[36,6,40,4],[36,10,40,8],[37,8,41,6],[37,14,41,12,"token"],[37,19,41,17],[37,22,41,20],[37,28,41,26,"AsyncStorage"],[37,40,41,38],[37,41,41,38,"default"],[37,48,41,38],[37,49,41,39,"getItem"],[37,56,41,46],[37,57,41,47],[37,72,41,62],[37,73,41,63],[38,8,42,6],[38,12,42,10,"token"],[38,17,42,15],[38,19,42,17],[39,10,43,8],[39,16,43,14,"userData"],[39,24,43,22],[39,27,43,25],[39,33,43,31,"authAPI"],[39,45,43,38],[39,46,43,38,"authAPI"],[39,53,43,38],[39,54,43,39,"getMe"],[39,59,43,44],[39,60,43,45],[39,61,43,46],[40,10,44,8,"setUser"],[40,17,44,15],[40,18,44,16,"userData"],[40,26,44,24],[40,27,44,25],[41,8,45,6],[42,6,46,4],[42,7,46,5],[42,8,46,6],[42,15,46,13,"error"],[42,20,46,18],[42,22,46,20],[43,8,47,6,"console"],[43,15,47,13],[43,16,47,14,"log"],[43,19,47,17],[43,20,47,18],[43,40,47,38],[43,42,47,40,"error"],[43,47,47,45],[43,48,47,46],[44,8,48,6],[44,14,48,12,"AsyncStorage"],[44,26,48,24],[44,27,48,24,"default"],[44,34,48,24],[44,35,48,25,"removeItem"],[44,45,48,35],[44,46,48,36],[44,61,48,51],[44,62,48,52],[45,8,49,6,"setUser"],[45,15,49,13],[45,16,49,14],[45,20,49,18],[45,21,49,19],[46,6,50,4],[46,7,50,5],[46,16,50,14],[47,8,51,6,"setLoading"],[47,18,51,16],[47,19,51,17],[47,24,51,22],[47,25,51,23],[48,6,52,4],[49,4,53,2],[49,5,53,3],[49,7,53,5],[49,9,53,7],[49,10,53,8],[50,4,55,2],[50,8,55,2,"useEffect"],[50,14,55,11],[50,15,55,11,"useEffect"],[50,24,55,11],[50,26,55,12],[50,32,55,18],[51,6,56,4,"checkAuth"],[51,15,56,13],[51,16,56,14],[51,17,56,15],[52,4,57,2],[52,5,57,3],[52,7,57,5],[52,8,57,6,"checkAuth"],[52,17,57,15],[52,18,57,16],[52,19,57,17],[53,4,59,2],[53,10,59,8,"login"],[53,15,59,13],[53,18,59,16],[53,24,59,23,"sessionId"],[53,33,59,40],[53,37,59,45],[54,6,60,4,"setLoading"],[54,16,60,14],[54,17,60,15],[54,21,60,19],[54,22,60,20],[55,6,61,4],[55,10,61,8],[56,8,62,6],[56,14,62,12,"result"],[56,20,62,18],[56,23,62,21],[56,29,62,27,"authAPI"],[56,41,62,34],[56,42,62,34,"authAPI"],[56,49,62,34],[56,50,62,35,"exchangeSession"],[56,65,62,50],[56,66,62,51,"sessionId"],[56,75,62,60],[56,76,62,61],[57,8,63,6],[57,12,63,10,"result"],[57,18,63,16],[57,19,63,17,"user"],[57,23,63,21],[57,25,63,23],[58,10,64,8,"setUser"],[58,17,64,15],[58,18,64,16,"result"],[58,24,64,22],[58,25,64,23,"user"],[58,29,64,27],[58,30,64,28],[59,10,65,8],[60,8,66,6],[61,6,67,4],[61,7,67,5],[61,8,67,6],[61,15,67,13,"error"],[61,20,67,18],[61,22,67,20],[62,8,68,6,"console"],[62,15,68,13],[62,16,68,14,"error"],[62,21,68,19],[62,22,68,20],[62,37,68,35],[62,39,68,37,"error"],[62,44,68,42],[62,45,68,43],[63,8,69,6],[63,14,69,12,"error"],[63,19,69,17],[64,6,70,4],[64,7,70,5],[64,16,70,14],[65,8,71,6,"setLoading"],[65,18,71,16],[65,19,71,17],[65,24,71,22],[65,25,71,23],[66,6,72,4],[67,4,73,2],[67,5,73,3],[68,4,75,2],[68,10,75,8,"logout"],[68,16,75,14],[68,19,75,17],[68,25,75,17,"logout"],[68,26,75,17],[68,31,75,29],[69,6,76,4,"setLoading"],[69,16,76,14],[69,17,76,15],[69,21,76,19],[69,22,76,20],[70,6,77,4],[70,10,77,8],[71,8,78,6],[71,14,78,12,"authAPI"],[71,26,78,19],[71,27,78,19,"authAPI"],[71,34,78,19],[71,35,78,20,"logout"],[71,41,78,26],[71,42,78,27],[71,43,78,28],[72,6,79,4],[72,7,79,5],[72,8,79,6],[72,15,79,13,"error"],[72,20,79,18],[72,22,79,20],[73,8,80,6,"console"],[73,15,80,13],[73,16,80,14,"error"],[73,21,80,19],[73,22,80,20],[73,37,80,35],[73,39,80,37,"error"],[73,44,80,42],[73,45,80,43],[74,6,81,4],[74,7,81,5],[74,16,81,14],[75,8,82,6,"setUser"],[75,15,82,13],[75,16,82,14],[75,20,82,18],[75,21,82,19],[76,8,83,6],[76,14,83,12,"AsyncStorage"],[76,26,83,24],[76,27,83,24,"default"],[76,34,83,24],[76,35,83,25,"removeItem"],[76,45,83,35],[76,46,83,36],[76,61,83,51],[76,62,83,52],[77,8,84,6,"setLoading"],[77,18,84,16],[77,19,84,17],[77,24,84,22],[77,25,84,23],[78,6,85,4],[79,4,86,2],[79,5,86,3],[80,4,88,2],[80,10,88,8,"refreshUser"],[80,21,88,19],[80,24,88,22],[80,30,88,22,"refreshUser"],[80,31,88,22],[80,36,88,34],[81,6,89,4],[81,10,89,8],[82,8,90,6],[82,14,90,12,"userData"],[82,22,90,20],[82,25,90,23],[82,31,90,29,"authAPI"],[82,43,90,36],[82,44,90,36,"authAPI"],[82,51,90,36],[82,52,90,37,"getMe"],[82,57,90,42],[82,58,90,43],[82,59,90,44],[83,8,91,6,"setUser"],[83,15,91,13],[83,16,91,14,"userData"],[83,24,91,22],[83,25,91,23],[84,6,92,4],[84,7,92,5],[84,8,92,6],[84,15,92,13,"error"],[84,20,92,18],[84,22,92,20],[85,8,93,6,"console"],[85,15,93,13],[85,16,93,14,"error"],[85,21,93,19],[85,22,93,20],[85,44,93,42],[85,46,93,44,"error"],[85,51,93,49],[85,52,93,50],[86,6,94,4],[87,4,95,2],[87,5,95,3],[88,4,97,2],[88,24,98,4],[88,28,98,4,"_reactJsxDevRuntime"],[88,47,98,4],[88,48,98,4,"jsxDEV"],[88,54,98,4],[88,56,98,5,"AuthContext"],[88,67,98,16],[88,68,98,17,"Provider"],[88,76,98,25],[89,6,99,6,"value"],[89,11,99,11],[89,13,99,13],[90,8,100,8,"user"],[90,12,100,12],[91,8,101,8,"loading"],[91,15,101,15],[92,8,102,8,"isAuthenticated"],[92,23,102,23],[92,25,102,25],[92,26,102,26],[92,27,102,27,"user"],[92,31,102,31],[93,8,103,8,"login"],[93,13,103,13],[94,8,104,8,"logout"],[94,14,104,14],[95,8,105,8,"refreshUser"],[95,19,105,19],[96,8,106,8,"setUser"],[97,6,107,6],[97,7,107,8],[98,6,107,8,"children"],[98,14,107,8],[98,16,109,7,"children"],[99,4,109,15],[100,6,109,15,"fileName"],[100,14,109,15],[100,16,109,15,"_jsxFileName"],[100,28,109,15],[101,6,109,15,"lineNumber"],[101,16,109,15],[102,6,109,15,"columnNumber"],[102,18,109,15],[103,4,109,15],[103,11,110,26],[103,12,110,27],[104,2,112,0],[105,2,112,1,"_s"],[105,4,112,1],[105,5,28,16,"AuthProvider"],[105,17,28,28],[106,2,28,28,"_c"],[106,4,28,28],[106,7,28,16,"AuthProvider"],[106,19,28,28],[107,2,114,7],[107,11,114,16,"useAuth"],[107,18,114,23,"useAuth"],[107,19,114,23],[107,21,114,26],[108,4,114,26,"_s2"],[108,7,114,26],[109,4,115,2],[109,10,115,8,"context"],[109,17,115,15],[109,20,115,18],[109,24,115,18,"useContext"],[109,30,115,28],[109,31,115,28,"useContext"],[109,41,115,28],[109,43,115,29,"AuthContext"],[109,54,115,40],[109,55,115,41],[110,4,116,2],[110,8,116,6,"context"],[110,15,116,13],[110,20,116,18,"undefined"],[110,29,116,27],[110,31,116,29],[111,6,117,4],[111,12,117,10],[111,16,117,14,"Error"],[111,21,117,19],[111,22,117,20],[111,67,117,65],[111,68,117,66],[112,4,118,2],[113,4,119,2],[113,11,119,9,"context"],[113,18,119,16],[114,2,120,0],[115,2,120,1,"_s2"],[115,5,120,1],[115,6,114,16,"useAuth"],[115,13,114,23],[116,2,114,23],[116,6,114,23,"_c"],[116,8,114,23],[117,2,114,23,"$RefreshReg$"],[117,14,114,23],[117,15,114,23,"_c"],[117,17,114,23],[118,0,114,23],[118,3]],"functionMap":{"names":["<global>","AuthProvider","checkAuth","useEffect$argument_0","login","logout","refreshUser","useAuth"],"mappings":"AAA;OC2B;gCCI;GDqB;YEE;GFE;gBGE;GHc;iBIE;GJW;sBKE;GLO;CDiB;OOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}